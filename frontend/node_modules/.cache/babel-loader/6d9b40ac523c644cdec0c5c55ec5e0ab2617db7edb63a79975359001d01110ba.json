{"ast":null,"code":"import _toConsumableArray from \"F:/python/course/crowdsensing/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.flat-map.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.array.unscopables.flat-map.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.flat-map.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.timers.js\";\nexport default {\n  name: 'HunterStatisticsChart',\n  props: {\n    hunters: {\n      type: Array,\n      \"default\": function _default() {\n        return [];\n      }\n    },\n    targets: {\n      type: Array,\n      \"default\": function _default() {\n        return [];\n      }\n    },\n    stepCount: {\n      type: Number,\n      \"default\": 0\n    },\n    isRunning: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  data: function data() {\n    return {\n      chartInstance: null,\n      chartInitialized: false,\n      chartLoading: false,\n      distanceChartSeries: [],\n      agentDistances: {},\n      maxDataPoints: 100,\n      chartUpdateTimer: null,\n      lastChartUpdate: 0,\n      optimizeChartUpdates: true,\n      colorPalette: ['#4285F4', '#34A853', '#EA4335', '#FBBC05'] // 谷歌色彩，更鲜明的对比\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n    this.initChart();\n    // 尝试从本地存储恢复数据\n    try {\n      var savedData = localStorage.getItem('simulation_final_data');\n      if (savedData) {\n        var parsedData = JSON.parse(savedData);\n        // 如果是当前模拟且数据不超过1小时\n        if (parsedData.simulationId == this.$route.params.id && new Date().getTime() - parsedData.timestamp < 3600000) {\n          this.distanceChartSeries = JSON.parse(parsedData.chartData);\n          // 强制更新图表\n          this.$nextTick(function () {\n            if (_this.chartInstance) {\n              _this.chartInstance.updateSeries(_this.distanceChartSeries);\n            }\n          });\n        }\n      }\n    } catch (e) {\n      console.error('恢复图表数据失败:', e);\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.destroyChart();\n  },\n  methods: {\n    initChart: function initChart() {\n      var _this2 = this;\n      this.chartLoading = true;\n\n      // 初始化数据系列\n      if (this.hunters.length > 0) {\n        this.distanceChartSeries = this.hunters.map(function (hunter, index) {\n          return {\n            name: \"\\u730E\\u624B \".concat(hunter.id),\n            data: [],\n            color: _this2.colorPalette[index % _this2.colorPalette.length]\n          };\n        });\n        this.hunters.forEach(function (hunter) {\n          _this2.agentDistances[hunter.id] = [];\n        });\n        this.$nextTick(function () {\n          setTimeout(function () {\n            _this2.createChartInstance();\n          }, 300);\n        });\n      } else {\n        this.chartLoading = false;\n      }\n    },\n    createChartInstance: function createChartInstance() {\n      var _this3 = this;\n      try {\n        // 确保没有现有图表实例\n        this.destroyChart();\n\n        // 确保容器存在\n        var container = document.getElementById('hunter-distance-chart');\n        if (!container) {\n          console.error('找不到图表容器元素');\n          return;\n        }\n\n        // 使用普通方式创建图表而不是Vue组件\n        import('apexcharts').then(function (ApexCharts) {\n          _this3.chartInstance = new ApexCharts[\"default\"](container, {\n            chart: {\n              type: 'line',\n              height: 240,\n              // 增加高度以提供更好的可视性\n              animations: {\n                enabled: false\n              },\n              toolbar: {\n                show: true\n              },\n              // 启用工具栏方便查看\n              background: '#fff',\n              fontFamily: 'Roboto, sans-serif',\n              zoom: {\n                enabled: true\n              } // 启用缩放功能\n            },\n            xaxis: {\n              type: 'numeric',\n              title: {\n                text: '步数',\n                style: {\n                  fontSize: '12px',\n                  fontWeight: 600\n                }\n              },\n              labels: {\n                formatter: function formatter(val) {\n                  return Math.floor(val);\n                },\n                style: {\n                  fontSize: '11px'\n                }\n              },\n              tickAmount: 5\n            },\n            yaxis: {\n              title: {\n                text: '与目标距离',\n                style: {\n                  fontSize: '12px',\n                  fontWeight: 600\n                }\n              },\n              min: 0,\n              // 确保从0开始\n              labels: {\n                style: {\n                  fontSize: '11px'\n                },\n                formatter: function formatter(val) {\n                  return val.toFixed(1);\n                }\n              },\n              tickAmount: 5\n            },\n            colors: _this3.colorPalette,\n            stroke: {\n              width: 3,\n              // 增加线宽\n              curve: 'smooth',\n              // 平滑曲线\n              lineCap: 'round'\n            },\n            markers: {\n              size: 4,\n              // 增加标记大小\n              strokeWidth: 0,\n              hover: {\n                size: 6\n              }\n            },\n            tooltip: {\n              x: {\n                title: {\n                  formatter: function formatter() {\n                    return '步数';\n                  }\n                }\n              },\n              y: {\n                formatter: function formatter(val) {\n                  return \"\".concat(val.toFixed(2), \" \\u5355\\u4F4D\");\n                }\n              }\n            },\n            legend: {\n              position: 'top',\n              horizontalAlign: 'right',\n              fontSize: '12px',\n              fontWeight: 500,\n              markers: {\n                size: 8,\n                strokeWidth: 0\n              }\n            },\n            grid: {\n              borderColor: '#e0e0e0',\n              row: {\n                colors: ['#f3f3f3', 'transparent'],\n                opacity: 0.5\n              }\n            },\n            series: _this3.distanceChartSeries,\n            noData: {\n              text: '暂无数据',\n              align: 'center',\n              verticalAlign: 'middle',\n              style: {\n                fontSize: '14px'\n              }\n            }\n          });\n          _this3.chartInstance.render().then(function () {\n            console.log('图表渲染成功');\n            _this3.chartInitialized = true;\n            _this3.chartLoading = false;\n          })[\"catch\"](function (err) {\n            console.error('图表渲染失败:', err);\n            _this3.chartLoading = false;\n          });\n        })[\"catch\"](function (err) {\n          console.error('加载ApexCharts库失败:', err);\n          _this3.chartLoading = false;\n        });\n      } catch (error) {\n        console.error('创建图表实例失败:', error);\n        this.chartLoading = false;\n      }\n    },\n    destroyChart: function destroyChart() {\n      if (this.chartInstance) {\n        try {\n          this.chartInstance.destroy();\n          this.chartInstance = null;\n        } catch (e) {\n          console.error('销毁图表实例失败:', e);\n        }\n      }\n      if (this.chartUpdateTimer) {\n        clearTimeout(this.chartUpdateTimer);\n        this.chartUpdateTimer = null;\n      }\n    },\n    updateChart: function updateChart() {\n      var _this4 = this;\n      var now = performance.now();\n      var timeSinceLastUpdate = now - this.lastChartUpdate;\n\n      // 如果数据是实时的并且距离上次更新不到200ms，延迟更新\n      if (this.optimizeChartUpdates && this.isRunning && timeSinceLastUpdate < 200) {\n        if (!this.chartUpdateTimer) {\n          this.chartUpdateTimer = setTimeout(function () {\n            _this4.updateChartData();\n            _this4.chartUpdateTimer = null;\n            _this4.lastChartUpdate = performance.now();\n          }, 200 - timeSinceLastUpdate);\n        }\n      } else {\n        // 直接更新\n        if (this.chartUpdateTimer) {\n          clearTimeout(this.chartUpdateTimer);\n          this.chartUpdateTimer = null;\n        }\n        this.updateChartData();\n        this.lastChartUpdate = now;\n      }\n      // 添加特殊处理：即使在模拟停止后也要确保最后一次数据更新\n      if (this.isCaptured || !this.isRunning) {\n        // 确保捕获后或停止后的最后一次数据更新\n        this.updateChartData();\n\n        // 存储最终状态到本地存储，以便在页面刷新或重新进入时恢复\n        var finalData = {\n          simulationId: this.$route.params.id,\n          chartData: JSON.stringify(this.distanceChartSeries),\n          stepCount: this.stepCount,\n          timestamp: new Date().getTime()\n        };\n        localStorage.setItem('simulation_final_data', JSON.stringify(finalData));\n      }\n    },\n    updateChartData: function updateChartData() {\n      var _this5 = this;\n      try {\n        if (!this.chartInitialized || !this.chartInstance || !this.hunters.length || !this.targets.length) {\n          return;\n        }\n        var target = this.targets[0];\n        if (!target || !target.position) return;\n\n        // 更新数据\n        var dataUpdated = false;\n        this.hunters.forEach(function (hunter, index) {\n          // 确保猎手数据有效\n          if (!hunter || !hunter.position) return;\n\n          // 计算与目标的距离\n          var distance = _this5.calculateDistance(hunter.position, target.position);\n          if (!_this5.agentDistances[hunter.id]) {\n            _this5.agentDistances[hunter.id] = [];\n          }\n\n          // 添加数据点\n          _this5.agentDistances[hunter.id].push({\n            x: _this5.stepCount,\n            y: Math.round(distance * 100) / 100\n          });\n\n          // 限制数据点数量，保留首尾点以保持图表连续性\n          if (_this5.agentDistances[hunter.id].length > _this5.maxDataPoints) {\n            var firstPoint = _this5.agentDistances[hunter.id][0];\n            var lastPoints = _this5.agentDistances[hunter.id].slice(-_this5.maxDataPoints + 1);\n            _this5.agentDistances[hunter.id] = [firstPoint].concat(_toConsumableArray(lastPoints));\n          }\n\n          // 更新系列数据\n          if (index < _this5.distanceChartSeries.length) {\n            _this5.distanceChartSeries[index].data = _toConsumableArray(_this5.agentDistances[hunter.id]);\n            dataUpdated = true;\n          }\n        });\n\n        // 仅当数据更新时才更新图表\n        if (dataUpdated && this.chartInstance) {\n          this.chartInstance.updateSeries(this.distanceChartSeries);\n\n          // 根据当前数据动态调整Y轴范围\n          this.optimizeYAxisRange();\n        }\n      } catch (error) {\n        console.error('更新图表数据失败:', error);\n      }\n    },\n    // 新增：优化Y轴范围方法\n    optimizeYAxisRange: function optimizeYAxisRange() {\n      var allDistances = this.distanceChartSeries.flatMap(function (series) {\n        return series.data.map(function (point) {\n          return point.y;\n        });\n      });\n      if (allDistances.length > 0) {\n        var maxDistance = Math.max.apply(Math, _toConsumableArray(allDistances));\n        var minDistance = Math.min.apply(Math, _toConsumableArray(allDistances));\n        var range = maxDistance - minDistance;\n\n        // 只有当范围足够小时才调整Y轴，避免频繁变化\n        if (range < maxDistance * 0.5) {\n          var padding = range * 0.2; // 20%的上下边距\n          this.chartInstance.updateOptions({\n            yaxis: {\n              min: Math.max(0, minDistance - padding),\n              max: maxDistance + padding,\n              labels: {\n                formatter: function formatter(val) {\n                  return val.toFixed(1);\n                }\n              }\n            }\n          }, false, true);\n        }\n      }\n    },\n    calculateDistance: function calculateDistance(pos1, pos2) {\n      return Math.sqrt(Math.pow(pos1[0] - pos2[0], 2) + Math.pow(pos1[1] - pos2[1], 2));\n    }\n  },\n  watch: {\n    hunters: {\n      handler: function handler(newHunters) {\n        if (!this.chartInitialized && newHunters.length > 0) {\n          this.initChart();\n        } else if (this.chartInitialized && this.chartInstance) {\n          this.updateChart();\n        }\n      },\n      deep: true\n    },\n    targets: {\n      handler: function handler() {\n        if (this.chartInitialized && this.chartInstance) {\n          this.updateChart();\n        }\n      },\n      deep: true\n    },\n    stepCount: {\n      handler: function handler() {\n        if (this.chartInitialized && this.chartInstance) {\n          this.updateChart();\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","props","hunters","type","Array","default","targets","stepCount","Number","isRunning","Boolean","data","chartInstance","chartInitialized","chartLoading","distanceChartSeries","agentDistances","maxDataPoints","chartUpdateTimer","lastChartUpdate","optimizeChartUpdates","colorPalette","mounted","_this","initChart","savedData","localStorage","getItem","parsedData","JSON","parse","simulationId","$route","params","id","Date","getTime","timestamp","chartData","$nextTick","updateSeries","e","console","error","beforeDestroy","destroyChart","methods","_this2","length","map","hunter","index","concat","color","forEach","setTimeout","createChartInstance","_this3","container","document","getElementById","then","ApexCharts","chart","height","animations","enabled","toolbar","show","background","fontFamily","zoom","xaxis","title","text","style","fontSize","fontWeight","labels","formatter","val","Math","floor","tickAmount","yaxis","min","toFixed","colors","stroke","width","curve","lineCap","markers","size","strokeWidth","hover","tooltip","x","y","legend","position","horizontalAlign","grid","borderColor","row","opacity","series","noData","align","verticalAlign","render","log","err","destroy","clearTimeout","updateChart","_this4","now","performance","timeSinceLastUpdate","updateChartData","isCaptured","finalData","stringify","setItem","_this5","target","dataUpdated","distance","calculateDistance","push","round","firstPoint","lastPoints","slice","_toConsumableArray","optimizeYAxisRange","allDistances","flatMap","point","maxDistance","max","apply","minDistance","range","padding","updateOptions","pos1","pos2","sqrt","pow","watch","handler","newHunters","deep"],"sources":["src/components/simulation/HunterStatisticsChart.vue"],"sourcesContent":["<template>\r\n  <v-card class=\"hunter-chart-card\">\r\n    <v-card-title class=\"chart-title\">猎手统计</v-card-title>\r\n    <v-card-text class=\"chart-content\">\r\n      <div id=\"hunter-distance-chart\" ref=\"chartContainer\" class=\"chart-container\">\r\n        <div v-if=\"!chartInitialized || chartLoading\" class=\"chart-placeholder\">\r\n          正在加载图表...\r\n        </div>\r\n      </div>\r\n    </v-card-text>\r\n  </v-card>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'HunterStatisticsChart',\r\n  props: {\r\n    hunters: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    targets: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    stepCount: {\r\n      type: Number,\r\n      default: 0\r\n    },\r\n    isRunning: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      chartInstance: null,\r\n      chartInitialized: false,\r\n      chartLoading: false,\r\n      distanceChartSeries: [],\r\n      agentDistances: {},\r\n      maxDataPoints: 100,\r\n      chartUpdateTimer: null,\r\n      lastChartUpdate: 0,\r\n      optimizeChartUpdates: true,\r\n      colorPalette: ['#4285F4', '#34A853', '#EA4335', '#FBBC05'] // 谷歌色彩，更鲜明的对比\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initChart();\r\n    // 尝试从本地存储恢复数据\r\n    try {\r\n      const savedData = localStorage.getItem('simulation_final_data');\r\n      if (savedData) {\r\n        const parsedData = JSON.parse(savedData);\r\n        // 如果是当前模拟且数据不超过1小时\r\n        if (parsedData.simulationId == this.$route.params.id && \r\n            (new Date().getTime() - parsedData.timestamp < 3600000)) {\r\n          this.distanceChartSeries = JSON.parse(parsedData.chartData);\r\n          // 强制更新图表\r\n          this.$nextTick(() => {\r\n            if (this.chartInstance) {\r\n              this.chartInstance.updateSeries(this.distanceChartSeries);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('恢复图表数据失败:', e);\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    this.destroyChart();\r\n  },\r\n  methods: {\r\n    initChart() {\r\n      this.chartLoading = true;\r\n      \r\n      // 初始化数据系列\r\n      if (this.hunters.length > 0) {\r\n        this.distanceChartSeries = this.hunters.map((hunter, index) => ({\r\n          name: `猎手 ${hunter.id}`,\r\n          data: [],\r\n          color: this.colorPalette[index % this.colorPalette.length]\r\n        }));\r\n        \r\n        this.hunters.forEach(hunter => {\r\n          this.agentDistances[hunter.id] = [];\r\n        });\r\n        \r\n        this.$nextTick(() => {\r\n          setTimeout(() => {\r\n            this.createChartInstance();\r\n          }, 300);\r\n        });\r\n      } else {\r\n        this.chartLoading = false;\r\n      }\r\n    },\r\n    \r\n    createChartInstance() {\r\n      try {\r\n        // 确保没有现有图表实例\r\n        this.destroyChart();\r\n        \r\n        // 确保容器存在\r\n        const container = document.getElementById('hunter-distance-chart');\r\n        if (!container) {\r\n          console.error('找不到图表容器元素');\r\n          return;\r\n        }\r\n        \r\n        // 使用普通方式创建图表而不是Vue组件\r\n        import('apexcharts').then(ApexCharts => {\r\n          this.chartInstance = new ApexCharts.default(\r\n            container,\r\n            {\r\n              chart: {\r\n                type: 'line',\r\n                height: 240, // 增加高度以提供更好的可视性\r\n                animations: { enabled: false },\r\n                toolbar: { show: true }, // 启用工具栏方便查看\r\n                background: '#fff',\r\n                fontFamily: 'Roboto, sans-serif',\r\n                zoom: { enabled: true } // 启用缩放功能\r\n              },\r\n              xaxis: {\r\n                type: 'numeric',\r\n                title: { text: '步数', style: { fontSize: '12px', fontWeight: 600 } },\r\n                labels: { \r\n                  formatter: (val) => Math.floor(val),\r\n                  style: { fontSize: '11px' }\r\n                },\r\n                tickAmount: 5\r\n              },\r\n              yaxis: {\r\n                title: { \r\n                  text: '与目标距离', \r\n                  style: { fontSize: '12px', fontWeight: 600 } \r\n                },\r\n                min: 0, // 确保从0开始\r\n                labels: { \r\n                  style: { fontSize: '11px' },\r\n                  formatter: (val) => val.toFixed(1)\r\n                },\r\n                tickAmount: 5\r\n              },\r\n              colors: this.colorPalette,\r\n              stroke: {\r\n                width: 3, // 增加线宽\r\n                curve: 'smooth', // 平滑曲线\r\n                lineCap: 'round'\r\n              },\r\n              markers: { \r\n                size: 4, // 增加标记大小\r\n                strokeWidth: 0,\r\n                hover: { size: 6 }\r\n              },\r\n              tooltip: {\r\n                x: { title: { formatter: () => '步数' } },\r\n                y: { formatter: (val) => `${val.toFixed(2)} 单位` }\r\n              },\r\n              legend: {\r\n                position: 'top',\r\n                horizontalAlign: 'right',\r\n                fontSize: '12px',\r\n                fontWeight: 500,\r\n                markers: { size: 8, strokeWidth: 0 }\r\n              },\r\n              grid: { \r\n                borderColor: '#e0e0e0',\r\n                row: { colors: ['#f3f3f3', 'transparent'], opacity: 0.5 }\r\n              },\r\n              series: this.distanceChartSeries,\r\n              noData: {\r\n                text: '暂无数据',\r\n                align: 'center',\r\n                verticalAlign: 'middle',\r\n                style: {\r\n                  fontSize: '14px'\r\n                }\r\n              }\r\n            }\r\n          );\r\n          \r\n          this.chartInstance.render().then(() => {\r\n            console.log('图表渲染成功');\r\n            this.chartInitialized = true;\r\n            this.chartLoading = false;\r\n          }).catch(err => {\r\n            console.error('图表渲染失败:', err);\r\n            this.chartLoading = false;\r\n          });\r\n        }).catch(err => {\r\n          console.error('加载ApexCharts库失败:', err);\r\n          this.chartLoading = false;\r\n        });\r\n      } catch (error) {\r\n        console.error('创建图表实例失败:', error);\r\n        this.chartLoading = false;\r\n      }\r\n    },\r\n    \r\n    destroyChart() {\r\n      if (this.chartInstance) {\r\n        try {\r\n          this.chartInstance.destroy();\r\n          this.chartInstance = null;\r\n        } catch (e) {\r\n          console.error('销毁图表实例失败:', e);\r\n        }\r\n      }\r\n      \r\n      if (this.chartUpdateTimer) {\r\n        clearTimeout(this.chartUpdateTimer);\r\n        this.chartUpdateTimer = null;\r\n      }\r\n    },\r\n    \r\n    updateChart() {\r\n      const now = performance.now();\r\n      const timeSinceLastUpdate = now - this.lastChartUpdate;\r\n      \r\n      // 如果数据是实时的并且距离上次更新不到200ms，延迟更新\r\n      if (this.optimizeChartUpdates && this.isRunning && timeSinceLastUpdate < 200) {\r\n        if (!this.chartUpdateTimer) {\r\n          this.chartUpdateTimer = setTimeout(() => {\r\n            this.updateChartData();\r\n            this.chartUpdateTimer = null;\r\n            this.lastChartUpdate = performance.now();\r\n          }, 200 - timeSinceLastUpdate);\r\n        }\r\n      } else {\r\n        // 直接更新\r\n        if (this.chartUpdateTimer) {\r\n          clearTimeout(this.chartUpdateTimer);\r\n          this.chartUpdateTimer = null;\r\n        }\r\n        this.updateChartData();\r\n        this.lastChartUpdate = now;\r\n      }\r\n      // 添加特殊处理：即使在模拟停止后也要确保最后一次数据更新\r\n      if (this.isCaptured || !this.isRunning) {\r\n        // 确保捕获后或停止后的最后一次数据更新\r\n        this.updateChartData();\r\n        \r\n        // 存储最终状态到本地存储，以便在页面刷新或重新进入时恢复\r\n        const finalData = {\r\n          simulationId: this.$route.params.id,\r\n          chartData: JSON.stringify(this.distanceChartSeries),\r\n          stepCount: this.stepCount,\r\n          timestamp: new Date().getTime()\r\n        };\r\n        localStorage.setItem('simulation_final_data', JSON.stringify(finalData));\r\n      }\r\n    },\r\n    \r\n    updateChartData() {\r\n      try {\r\n        if (!this.chartInitialized || !this.chartInstance || \r\n            !this.hunters.length || !this.targets.length) {\r\n          return;\r\n        }\r\n        \r\n        const target = this.targets[0];\r\n        if (!target || !target.position) return;\r\n        \r\n        // 更新数据\r\n        let dataUpdated = false;\r\n        \r\n        this.hunters.forEach((hunter, index) => {\r\n          // 确保猎手数据有效\r\n          if (!hunter || !hunter.position) return;\r\n          \r\n          // 计算与目标的距离\r\n          const distance = this.calculateDistance(hunter.position, target.position);\r\n          \r\n          if (!this.agentDistances[hunter.id]) {\r\n            this.agentDistances[hunter.id] = [];\r\n          }\r\n          \r\n          // 添加数据点\r\n          this.agentDistances[hunter.id].push({\r\n            x: this.stepCount,\r\n            y: Math.round(distance * 100) / 100\r\n          });\r\n          \r\n          // 限制数据点数量，保留首尾点以保持图表连续性\r\n          if (this.agentDistances[hunter.id].length > this.maxDataPoints) {\r\n            const firstPoint = this.agentDistances[hunter.id][0];\r\n            const lastPoints = this.agentDistances[hunter.id].slice(-this.maxDataPoints + 1);\r\n            this.agentDistances[hunter.id] = [firstPoint, ...lastPoints];\r\n          }\r\n          \r\n          // 更新系列数据\r\n          if (index < this.distanceChartSeries.length) {\r\n            this.distanceChartSeries[index].data = [...this.agentDistances[hunter.id]];\r\n            dataUpdated = true;\r\n          }\r\n        });\r\n        \r\n        // 仅当数据更新时才更新图表\r\n        if (dataUpdated && this.chartInstance) {\r\n          this.chartInstance.updateSeries(this.distanceChartSeries);\r\n          \r\n          // 根据当前数据动态调整Y轴范围\r\n          this.optimizeYAxisRange();\r\n        }\r\n      } catch (error) {\r\n        console.error('更新图表数据失败:', error);\r\n      }\r\n    },\r\n\r\n    // 新增：优化Y轴范围方法\r\n    optimizeYAxisRange() {\r\n      const allDistances = this.distanceChartSeries.flatMap(series => \r\n        series.data.map(point => point.y)\r\n      );\r\n      \r\n      if (allDistances.length > 0) {\r\n        const maxDistance = Math.max(...allDistances);\r\n        const minDistance = Math.min(...allDistances);\r\n        const range = maxDistance - minDistance;\r\n        \r\n        // 只有当范围足够小时才调整Y轴，避免频繁变化\r\n        if (range < maxDistance * 0.5) {\r\n          const padding = range * 0.2; // 20%的上下边距\r\n          this.chartInstance.updateOptions({\r\n            yaxis: {\r\n              min: Math.max(0, minDistance - padding),\r\n              max: maxDistance + padding,\r\n              labels: { \r\n                formatter: (val) => val.toFixed(1)\r\n              }\r\n            }\r\n          }, false, true);\r\n        }\r\n      }\r\n    },\r\n    \r\n    calculateDistance(pos1, pos2) {\r\n      return Math.sqrt(\r\n        Math.pow(pos1[0] - pos2[0], 2) + \r\n        Math.pow(pos1[1] - pos2[1], 2)\r\n      );\r\n    }\r\n  },\r\n  watch: {\r\n    hunters: {\r\n      handler(newHunters) {\r\n        if (!this.chartInitialized && newHunters.length > 0) {\r\n          this.initChart();\r\n        } else if (this.chartInitialized && this.chartInstance) {\r\n          this.updateChart();\r\n        }\r\n      },\r\n      deep: true\r\n    },\r\n    \r\n    targets: {\r\n      handler() {\r\n        if (this.chartInitialized && this.chartInstance) {\r\n          this.updateChart();\r\n        }\r\n      },\r\n      deep: true\r\n    },\r\n    \r\n    stepCount: {\r\n      handler() {\r\n        if (this.chartInitialized && this.chartInstance) {\r\n          this.updateChart();\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.hunter-chart-card {\r\n  margin-bottom: 8px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.chart-title {\r\n  font-size: 1rem;\r\n  padding: 8px 12px !important;\r\n  min-height: 32px !important;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.chart-content {\r\n  padding: 8px !important;\r\n}\r\n\r\n.chart-container {\r\n  width: 100%;\r\n  height: 240px;\r\n  position: relative;\r\n  background-color: #fff;\r\n  border-radius: 4px;\r\n  box-shadow: 0 0 2px rgba(0,0,0,0.1) inset;\r\n}\r\n\r\n.chart-placeholder {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #666;\r\n  font-size: 0.9rem;\r\n  background-color: rgba(249, 249, 249, 0.7);\r\n  z-index: 1;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}