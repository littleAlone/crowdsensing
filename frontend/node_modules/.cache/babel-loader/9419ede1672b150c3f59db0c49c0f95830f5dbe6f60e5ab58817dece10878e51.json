{"ast":null,"code":"import _regeneratorRuntime from \"F:/python/course/crowdsensing/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"F:/python/course/crowdsensing/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"F:/python/course/crowdsensing/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/web.timers.js\";\n// 导入组件\nimport SimulationCanvas from '../components/SimulationCanvas.vue';\nimport SimulationInfo from '../components/simulation/SimulationInfo.vue';\nimport HunterStatisticsChart from '../components/simulation/HunterStatisticsChart.vue';\nimport PerformanceMonitor from '../components/simulation/PerformanceMonitor.vue';\nimport EnvironmentSettingsPanel from '../components/simulation/EnvironmentSettingsPanel.vue';\nimport { setupWebSocket, closeWebSocket } from '../components/simulation/WebSocketManager.js';\nimport { mapState, mapGetters } from 'vuex';\nexport default {\n  name: 'SimulationDetail',\n  components: {\n    SimulationCanvas: SimulationCanvas,\n    SimulationInfo: SimulationInfo,\n    HunterStatisticsChart: HunterStatisticsChart,\n    PerformanceMonitor: PerformanceMonitor,\n    EnvironmentSettingsPanel: EnvironmentSettingsPanel\n  },\n  props: {\n    simulationId: {\n      type: Number,\n      required: true\n    }\n  },\n  data: function data() {\n    return {\n      simulation: {},\n      isRunning: false,\n      isCaptured: false,\n      socket: null,\n      showTrails: true,\n      showVisionRange: false,\n      showCommunicationRange: false,\n      showDeleteDialog: false,\n      deleteLoading: false,\n      // 添加缺失的响应式属性\n      activeTab: 0,\n      // WebSocket相关状态\n      wsLatency: 0,\n      lastMessageTime: 0,\n      // 连接状态提示\n      showConnectionStatus: false,\n      connectionStatusText: '',\n      connectionStatusColor: 'info',\n      // 性能监控\n      renderTime: 0,\n      lastRenderTimestamp: 0,\n      // 数据处理相关\n      dataUpdateTimer: null,\n      // 连接状态标记\n      isConnecting: false\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread({}, mapState({\n    storeCurrentSimulation: function storeCurrentSimulation(state) {\n      return state.currentSimulation;\n    },\n    simulationsLoading: function simulationsLoading(state) {\n      return state.loading;\n    }\n  })), mapGetters(['getSimulationById'])), {}, {\n    statusChipColor: function statusChipColor() {\n      if (this.isCaptured) return 'success';\n      if (this.isRunning) return 'primary';\n      return 'grey';\n    },\n    statusChipText: function statusChipText() {\n      if (this.isCaptured) return '已捕获';\n      if (this.isRunning) return '进行中';\n      return '已停止';\n    }\n  }),\n  created: function created() {\n    // 注册错误处理事件监听\n    this.$root.$on('api-error', this.handleApiError);\n  },\n  mounted: function mounted() {\n    console.log('SimulationDetail mounted');\n    // 监听页面可见性变化\n    document.addEventListener('visibilitychange', this.handleVisibilityChange);\n    window.addEventListener('focus', this.handleWindowFocus);\n    window.addEventListener('blur', this.handleWindowBlur);\n\n    // 初始化组件\n    this.initializeComponent();\n  },\n  beforeDestroy: function beforeDestroy() {\n    console.log('SimulationDetail beforeDestroy');\n    // 清理资源\n    this.closeWebSocketConnection();\n    this.cleanupTimers();\n\n    // 移除事件监听\n    this.$root.$off('api-error', this.handleApiError);\n    document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n    window.removeEventListener('focus', this.handleWindowFocus);\n    window.removeEventListener('blur', this.handleWindowBlur);\n  },\n  methods: {\n    // 初始化组件\n    initializeComponent: function initializeComponent() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              console.log('初始化组件...');\n              _context.prev = 1;\n              _context.next = 4;\n              return _this.fetchSimulation();\n            case 4:\n              console.log('模拟数据获取成功:', _this.simulation.id);\n\n              // 检查障碍物数量，如果为0但输入值不为0，则生成障碍物\n              if (!((!_this.simulation.obstacles || _this.simulation.obstacles.length === 0) && _this.obstacleCount > 0)) {\n                _context.next = 9;\n                break;\n              }\n              console.log('初始化障碍物...');\n              _context.next = 9;\n              return _this.regenerateObstacles(_this.obstacleCount);\n            case 9:\n              // 设置捕获状态 - 确保正确加载已完成模拟的状态\n              _this.isRunning = _this.simulation.is_running;\n              _this.isCaptured = _this.simulation.is_captured;\n\n              // 仅在模拟正在运行且未被捕获时建立WebSocket连接\n              if (_this.isRunning && !_this.isCaptured) {\n                _this.setupWebSocketConnection();\n              } else if (_this.isCaptured) {\n                // 如果模拟已经完成，显示捕获成功界面\n                console.log('模拟已捕获，显示完成状态');\n\n                // 确保画布正确显示最终状态\n                _this.$nextTick(function () {\n                  if (_this.$refs.canvas) {\n                    _this.$refs.canvas.drawSimulation(true);\n                  }\n                });\n\n                // 可选：加载捕获时的快照数据\n                _this.loadFinalSnapshot();\n              }\n              _context.next = 18;\n              break;\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](1);\n              console.error('初始化组件失败:', _context.t0);\n              _this.showErrorStatus('初始化失败，请刷新页面重试');\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 14]]);\n      }))();\n    },\n    // 添加加载最终快照的方法\n    loadFinalSnapshot: function loadFinalSnapshot() {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return _this2.axios.get(\"/simulations/\".concat(_this2.simulationId, \"/final-snapshot\"));\n            case 3:\n              response = _context2.sent;\n              if (response.data) {\n                // 更新显示数据\n                if (response.data.hunters) {\n                  _this2.simulation.hunters = response.data.hunters;\n                }\n                if (response.data.targets) {\n                  _this2.simulation.targets = response.data.targets;\n                }\n                // 强制重绘画布\n                _this2.$nextTick(function () {\n                  if (_this2.$refs.canvas) {\n                    _this2.$refs.canvas.drawSimulation(true);\n                  }\n                });\n              }\n              _context2.next = 10;\n              break;\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.warn('加载最终快照失败:', _context2.t0);\n              // 加载失败时不中断流程，使用默认显示\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 7]]);\n      }))();\n    },\n    // 获取模拟数据\n    fetchSimulation: function fetchSimulation() {\n      var _this3 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var storeSimulation, response;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              console.log('获取模拟数据, ID:', _this3.simulationId);\n              // 尝试从store获取数据\n              storeSimulation = _this3.getSimulationById(_this3.simulationId); // 如果store中没有数据，从API获取\n              if (storeSimulation) {\n                _context3.next = 11;\n                break;\n              }\n              console.log('从API获取模拟数据');\n              _context3.next = 7;\n              return _this3.$store.dispatch('fetchSimulation', _this3.simulationId);\n            case 7:\n              response = _context3.sent;\n              _this3.simulation = response;\n              _context3.next = 13;\n              break;\n            case 11:\n              console.log('从Store获取模拟数据');\n              _this3.simulation = storeSimulation;\n            case 13:\n              // 更新状态\n              _this3.isRunning = _this3.simulation.is_running;\n              _this3.isCaptured = _this3.simulation.is_captured;\n              console.log('模拟数据获取完成:', _this3.simulation.name);\n              return _context3.abrupt(\"return\", _this3.simulation);\n            case 19:\n              _context3.prev = 19;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error('获取模拟数据失败:', _context3.t0);\n              _this3.$toast.error('获取模拟数据失败');\n              throw _context3.t0;\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[0, 19]]);\n      }))();\n    },\n    // 设置WebSocket连接\n    setupWebSocketConnection: function setupWebSocketConnection() {\n      var _this4 = this;\n      // 连接创建中标记，防止重复创建\n      if (this.isConnecting) {\n        console.log('WebSocket连接已在创建中，避免重复创建');\n        return;\n      }\n      this.isConnecting = true;\n\n      // 确保先关闭已有连接\n      if (this.socket) {\n        console.log('关闭已有WebSocket连接，准备创建新连接');\n        this.closeWebSocketConnection();\n\n        // 添加短延迟确保连接完全关闭\n        setTimeout(function () {\n          _this4.createNewWebSocketConnection();\n        }, 300);\n      } else {\n        this.createNewWebSocketConnection();\n      }\n    },\n    // 提取创建连接的逻辑为单独方法\n    createNewWebSocketConnection: function createNewWebSocketConnection() {\n      var _this5 = this;\n      console.log(\"\\u521B\\u5EFAWebSocket\\u8FDE\\u63A5\\uFF0C\\u6A21\\u62DFID: \".concat(this.simulationId));\n      this.socket = setupWebSocket(this.simulationId, {\n        onOpen: function onOpen() {\n          console.log(\"WebSocket\\u8FDE\\u63A5\\u5DF2\\u5EFA\\u7ACB\\uFF0C\\u6A21\\u62DFID: \".concat(_this5.simulationId));\n          _this5.showSuccessStatus('WebSocket连接已建立');\n          _this5.isConnecting = false; // 重置连接状态\n        },\n        onMessage: function onMessage(data) {\n          _this5.handleWebSocketMessage(data);\n        },\n        onClose: function onClose(event) {\n          // 如果是正常关闭，不显示错误\n          if (event.code !== 1000 && event.code !== 1001) {\n            _this5.showWarningStatus('WebSocket连接已关闭');\n          }\n          _this5.isConnecting = false; // 重置连接状态\n        },\n        onError: function onError() {\n          _this5.showErrorStatus('WebSocket连接错误');\n          _this5.isConnecting = false; // 重置连接状态\n        }\n      });\n    },\n    // 改进closeWebSocketConnection方法\n    closeWebSocketConnection: function closeWebSocketConnection() {\n      if (this.socket) {\n        console.log(\"\\u5173\\u95EDWebSocket\\u8FDE\\u63A5\\uFF0C\\u6A21\\u62DFID: \".concat(this.simulationId));\n        closeWebSocket(this.socket);\n        this.socket = null;\n      }\n    },\n    // 处理WebSocket消息\n    handleWebSocketMessage: function handleWebSocketMessage(data) {\n      // 计算延迟\n      this.calculateWsLatency();\n\n      // 处理错误\n      if (data.error) {\n        console.error('WebSocket错误:', data.error);\n        this.$toast.error(\"WebSocket\\u9519\\u8BEF: \".concat(data.error));\n        return;\n      }\n\n      // 使用防抖更新数据，避免频繁更新\n      this.updateSimulationDataDebounced(data);\n    },\n    // 计算WebSocket延迟\n    calculateWsLatency: function calculateWsLatency() {\n      var now = performance.now();\n      if (this.lastMessageTime) {\n        this.wsLatency = Math.round(now - this.lastMessageTime);\n      }\n      this.lastMessageTime = now;\n    },\n    // 防抖更新数据\n    updateSimulationDataDebounced: function updateSimulationDataDebounced(data) {\n      var _this6 = this;\n      if (this.dataUpdateTimer) {\n        clearTimeout(this.dataUpdateTimer);\n      }\n      this.dataUpdateTimer = setTimeout(function () {\n        var startTime = performance.now();\n\n        // 更新模拟数据\n        _this6.simulation = data;\n        _this6.isRunning = data.is_running;\n        _this6.isCaptured = data.is_captured;\n\n        // 更新Vuex存储\n        _this6.$store.dispatch('updateSimulationAgents', {\n          simulationId: _this6.simulationId,\n          hunters: data.hunters || [],\n          targets: data.targets || []\n        });\n\n        // 计算渲染时间\n        _this6.renderTime = Math.round(performance.now() - startTime);\n      }, 50); // 50ms防抖延迟\n    },\n    // 模拟控制方法\n    startSimulation: function startSimulation() {\n      var _this7 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              // 先关闭可能存在的旧连接\n              console.log('启动模拟，关闭已有WebSocket连接');\n              _this7.closeWebSocketConnection();\n\n              // 添加短延迟确保连接完全关闭\n              _context4.next = 5;\n              return new Promise(function (resolve) {\n                return setTimeout(resolve, 200);\n              });\n            case 5:\n              _context4.next = 7;\n              return _this7.$store.dispatch('startSimulation', _this7.simulationId);\n            case 7:\n              _this7.isRunning = true;\n\n              // 重新建立WebSocket连接以接收实时更新\n              console.log('模拟已启动，创建新WebSocket连接');\n              _this7.setupWebSocketConnection();\n              _this7.$toast.success('模拟已启动');\n              _context4.next = 18;\n              break;\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error('启动模拟失败:', _context4.t0);\n              _this7.$toast.error('启动模拟失败');\n              _this7.isConnecting = false; // 确保重置连接状态\n            case 18:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[0, 13]]);\n      }))();\n    },\n    stopSimulation: function stopSimulation() {\n      var _this8 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return _this8.$store.dispatch('stopSimulation', _this8.simulationId);\n            case 3:\n              _this8.isRunning = false;\n              _this8.$toast.success('模拟已停止');\n              _context5.next = 11;\n              break;\n            case 7:\n              _context5.prev = 7;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.error('停止模拟失败:', _context5.t0);\n              _this8.$toast.error('停止模拟失败');\n            case 11:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[0, 7]]);\n      }))();\n    },\n    resetSimulation: function resetSimulation() {\n      var _this9 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var data;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 3;\n              return _this9.$store.dispatch('resetSimulation', _this9.simulationId);\n            case 3:\n              data = _context6.sent;\n              _this9.simulation = data;\n              _this9.isRunning = false;\n              _this9.isCaptured = false;\n              _this9.$toast.success('模拟已重置');\n              _context6.next = 14;\n              break;\n            case 10:\n              _context6.prev = 10;\n              _context6.t0 = _context6[\"catch\"](0);\n              console.error('重置模拟失败:', _context6.t0);\n              _this9.$toast.error('重置模拟失败');\n            case 14:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, null, [[0, 10]]);\n      }))();\n    },\n    deleteSimulation: function deleteSimulation() {\n      var _this10 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _this10.deleteLoading = true;\n              _context7.prev = 1;\n              _context7.next = 4;\n              return _this10.$store.dispatch('deleteSimulation', _this10.simulationId);\n            case 4:\n              _this10.$toast.success('模拟已删除');\n              _this10.$router.push('/simulations');\n              _context7.next = 12;\n              break;\n            case 8:\n              _context7.prev = 8;\n              _context7.t0 = _context7[\"catch\"](1);\n              console.error('删除模拟失败:', _context7.t0);\n              _this10.$toast.error('删除模拟失败');\n            case 12:\n              _context7.prev = 12;\n              _this10.deleteLoading = false;\n              _this10.showDeleteDialog = false;\n              return _context7.finish(12);\n            case 16:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, null, [[1, 8, 12, 16]]);\n      }))();\n    },\n    // 优化页面可见性变化处理\n    handleVisibilityChange: function handleVisibilityChange() {\n      if (document.hidden) {\n        // 页面隐藏时关闭WebSocket\n        console.log('页面隐藏，关闭WebSocket连接');\n        this.closeWebSocketConnection();\n      } else {\n        // 页面可见时，只在需要时重新连接\n        if (this.isRunning && !this.isCaptured && !this.socket && !this.isConnecting) {\n          console.log('页面可见，模拟运行中，重新连接WebSocket');\n          this.setupWebSocketConnection();\n        }\n      }\n    },\n    // 优化窗口焦点变化处理\n    handleWindowFocus: function handleWindowFocus() {\n      if (this.isRunning && !this.isCaptured && !this.socket && !this.isConnecting) {\n        console.log('窗口获得焦点，模拟运行中，重新连接WebSocket');\n        this.setupWebSocketConnection();\n      }\n    },\n    handleWindowBlur: function handleWindowBlur() {\n      // 窗口失去焦点时无需处理\n    },\n    // 导航方法\n    navigateToList: function navigateToList() {\n      // 清理资源后再导航\n      this.closeWebSocketConnection();\n      this.cleanupTimers();\n      this.$router.push('/simulations');\n    },\n    // 状态提示显示方法\n    showInfoStatus: function showInfoStatus(message) {\n      this.connectionStatusText = message;\n      this.connectionStatusColor = 'info';\n      this.showConnectionStatus = true;\n    },\n    showSuccessStatus: function showSuccessStatus(message) {\n      this.connectionStatusText = message;\n      this.connectionStatusColor = 'success';\n      this.showConnectionStatus = true;\n    },\n    showWarningStatus: function showWarningStatus(message) {\n      this.connectionStatusText = message;\n      this.connectionStatusColor = 'warning';\n      this.showConnectionStatus = true;\n    },\n    showErrorStatus: function showErrorStatus(message) {\n      this.connectionStatusText = message;\n      this.connectionStatusColor = 'error';\n      this.showConnectionStatus = true;\n    },\n    // 错误处理\n    handleApiError: function handleApiError(error) {\n      console.error('API错误:', error);\n\n      // 特定错误处理\n      if (error.status === 404 && error.message.includes('Simulation not found')) {\n        this.$toast.error('模拟不存在或已被删除');\n        this.$router.push('/simulations');\n      }\n    },\n    // 清理定时器\n    cleanupTimers: function cleanupTimers() {\n      if (this.dataUpdateTimer) {\n        clearTimeout(this.dataUpdateTimer);\n        this.dataUpdateTimer = null;\n      }\n    },\n    // 新增: 环境设置方法\n    toggleObstacles: function toggleObstacles(show) {\n      // 控制障碍物显示/隐藏\n      if (this.$refs.canvas) {\n        this.$refs.canvas.showObstacles = show;\n        this.drawSimulation(); // 重新绘制\n      }\n    },\n    regenerateObstacles: function regenerateObstacles(count) {\n      var _this11 = this;\n      // 显示加载状态\n      this.$toast.info(\"\\u6B63\\u5728\\u751F\\u6210\".concat(count, \"\\u4E2A\\u969C\\u788D\\u7269...\"));\n\n      // 调用API重新生成障碍物\n      this.axios.post(\"/simulations/\".concat(this.simulationId, \"/regenerate-obstacles\"), {\n        count: count\n      }).then(function (response) {\n        if (response.data && response.data.obstacles) {\n          // 更新模拟中的障碍物\n          _this11.simulation.obstacles = response.data.obstacles;\n          _this11.$toast.success('障碍物已重新生成');\n\n          // 强制重绘画布\n          if (_this11.$refs.canvas) {\n            _this11.$refs.canvas.drawSimulation(true);\n          }\n        }\n      })[\"catch\"](function (error) {\n        console.error('重新生成障碍物失败:', error);\n        _this11.$toast.error('重新生成障碍物失败');\n      });\n    },\n    watch: {\n      simulationId: {\n        handler: function handler(newId, oldId) {\n          if (newId !== oldId) {\n            console.log(\"\\u6A21\\u62DFID\\u53D8\\u66F4: \".concat(oldId, \" -> \").concat(newId));\n            // 重新初始化组件\n            this.closeWebSocketConnection();\n            this.cleanupTimers();\n            this.initializeComponent();\n          }\n        },\n        immediate: false\n      },\n      // 监视store中的当前模拟数据变化\n      storeCurrentSimulation: {\n        handler: function handler(newSimulation) {\n          if (newSimulation && newSimulation.id === this.simulationId) {\n            // 仅在首次加载或重要属性变化时更新本地数据\n            if (!this.simulation.id || newSimulation.is_running !== this.simulation.is_running || newSimulation.is_captured !== this.simulation.is_captured) {\n              this.simulation = newSimulation;\n              this.isRunning = newSimulation.is_running;\n              this.isCaptured = newSimulation.is_captured;\n            }\n          }\n        },\n        deep: true\n      }\n    }\n  }\n};","map":{"version":3,"names":["SimulationCanvas","SimulationInfo","HunterStatisticsChart","PerformanceMonitor","EnvironmentSettingsPanel","setupWebSocket","closeWebSocket","mapState","mapGetters","name","components","props","simulationId","type","Number","required","data","simulation","isRunning","isCaptured","socket","showTrails","showVisionRange","showCommunicationRange","showDeleteDialog","deleteLoading","activeTab","wsLatency","lastMessageTime","showConnectionStatus","connectionStatusText","connectionStatusColor","renderTime","lastRenderTimestamp","dataUpdateTimer","isConnecting","computed","_objectSpread","storeCurrentSimulation","state","currentSimulation","simulationsLoading","loading","statusChipColor","statusChipText","created","$root","$on","handleApiError","mounted","console","log","document","addEventListener","handleVisibilityChange","window","handleWindowFocus","handleWindowBlur","initializeComponent","beforeDestroy","closeWebSocketConnection","cleanupTimers","$off","removeEventListener","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","fetchSimulation","id","obstacles","length","obstacleCount","regenerateObstacles","is_running","is_captured","setupWebSocketConnection","$nextTick","$refs","canvas","drawSimulation","loadFinalSnapshot","t0","error","showErrorStatus","stop","_this2","_callee2","response","_callee2$","_context2","axios","get","concat","sent","hunters","targets","warn","_this3","_callee3","storeSimulation","_callee3$","_context3","getSimulationById","$store","dispatch","abrupt","$toast","_this4","setTimeout","createNewWebSocketConnection","_this5","onOpen","showSuccessStatus","onMessage","handleWebSocketMessage","onClose","event","code","showWarningStatus","onError","calculateWsLatency","updateSimulationDataDebounced","now","performance","Math","round","_this6","clearTimeout","startTime","startSimulation","_this7","_callee4","_callee4$","_context4","Promise","resolve","success","stopSimulation","_this8","_callee5","_callee5$","_context5","resetSimulation","_this9","_callee6","_callee6$","_context6","deleteSimulation","_this10","_callee7","_callee7$","_context7","$router","push","finish","hidden","navigateToList","showInfoStatus","message","status","includes","toggleObstacles","show","showObstacles","count","_this11","info","post","then","watch","handler","newId","oldId","immediate","newSimulation","deep"],"sources":["src/views/SimulationDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"simulation-detail\">\r\n    <v-container fluid class=\"content-container\">\r\n      <v-row no-gutters class=\"content-row\">\r\n        <!-- 左侧模拟画布区域 -->\r\n        <v-col cols=\"12\" md=\"8\" class=\"pr-md-2\">\r\n          <v-card class=\"simulation-canvas-card\">\r\n            <div class=\"d-flex align-center px-2\">\r\n              <div class=\"title-section\">\r\n                <span class=\"subtitle-1 font-weight-medium\">{{ simulation.name }}</span>\r\n              </div>\r\n              <v-spacer></v-spacer>\r\n              <v-chip x-small :color=\"statusChipColor\" text-color=\"white\" class=\"ml-2\">\r\n                {{ statusChipText }}\r\n              </v-chip>\r\n            </div>\r\n            \r\n            <!-- 模拟画布 - 传递障碍物信息 -->\r\n            <simulation-canvas\r\n              ref=\"canvas\"\r\n              :hunters=\"simulation.hunters || []\"\r\n              :targets=\"simulation.targets || []\"\r\n              :environment-size=\"simulation.environment_size || 500\"\r\n              :is-running=\"isRunning\"\r\n              :is-captured=\"isCaptured\"\r\n              :show-trails=\"showTrails\"\r\n              :show-vision-range=\"showVisionRange\"\r\n              :show-communication-range=\"showCommunicationRange\"\r\n              :obstacles=\"simulation.obstacles || []\"\r\n            ></simulation-canvas>\r\n          </v-card>\r\n        </v-col>\r\n        \r\n        <!-- 右侧控制面板和数据分析区域 -->\r\n        <v-col cols=\"12\" md=\"4\">\r\n          <v-card class=\"control-panel mb-2\">\r\n            <v-card-title class=\"py-1 subtitle-1\">控制面板</v-card-title>\r\n            <v-card-text class=\"py-1\">\r\n              <!-- 控制按钮组 -->\r\n              <div class=\"d-flex mb-3 justify-center\">\r\n                <v-btn small color=\"primary\" :disabled=\"isRunning || isCaptured\" @click=\"startSimulation\" class=\"mx-1\">\r\n                  <v-icon small left>mdi-play</v-icon>开始\r\n                </v-btn>\r\n                <v-btn small color=\"error\" :disabled=\"!isRunning\" @click=\"stopSimulation\" class=\"mx-1\">\r\n                  <v-icon small left>mdi-stop</v-icon>停止\r\n                </v-btn>\r\n                <v-btn small color=\"warning\" :disabled=\"isRunning\" @click=\"resetSimulation\" class=\"mx-1\">\r\n                  <v-icon small left>mdi-refresh</v-icon>重置\r\n                </v-btn>\r\n              </div>\r\n              \r\n              <!-- 显示选项 -->\r\n              <div class=\"display-options mb-2\">\r\n                <div class=\"subtitle-2 mb-1\">显示选项</div>\r\n                <v-row dense>\r\n                  <v-col cols=\"4\">\r\n                    <v-switch dense hide-details label=\"轨迹\" v-model=\"showTrails\" class=\"mt-0\"></v-switch>\r\n                  </v-col>\r\n                  <v-col cols=\"4\">\r\n                    <v-switch dense hide-details label=\"视野范围\" v-model=\"showVisionRange\" class=\"mt-0\"></v-switch>\r\n                  </v-col>\r\n                  <v-col cols=\"4\">\r\n                    <v-switch dense hide-details label=\"通信范围\" v-model=\"showCommunicationRange\" class=\"mt-0\"></v-switch>\r\n                  </v-col>\r\n                </v-row>\r\n              </div>\r\n            </v-card-text>\r\n          </v-card>\r\n\r\n          <!-- 环境设置面板 -->\r\n          <v-card class=\"mb-2\">\r\n            <environment-settings-panel\r\n              :is-running=\"isRunning\"\r\n              :current-obstacles=\"simulation.obstacles || []\"\r\n              @toggle-obstacles=\"toggleObstacles\"\r\n              @regenerate-obstacles=\"regenerateObstacles\"\r\n            ></environment-settings-panel>\r\n          </v-card>\r\n          \r\n          <!-- 数据分析区域 - 使用标签页组织内容 -->\r\n          <v-card>\r\n            <v-tabs v-model=\"activeTab\" background-color=\"primary\" dark dense>\r\n              <v-tab>模拟信息</v-tab>\r\n              <v-tab>统计图表</v-tab>\r\n            </v-tabs>\r\n            \r\n            <v-tabs-items v-model=\"activeTab\">\r\n              <v-tab-item>\r\n                <simulation-info :simulation=\"simulation\"></simulation-info>\r\n              </v-tab-item>\r\n              <v-tab-item>\r\n                <hunter-statistics-chart\r\n                  :hunters=\"simulation.hunters || []\"\r\n                  :targets=\"simulation.targets || []\"\r\n                  :step-count=\"simulation.step_count || 0\"\r\n                  :is-running=\"isRunning\"\r\n                ></hunter-statistics-chart>\r\n                \r\n                <performance-monitor\r\n                  v-if=\"simulation.step_count > 0\"\r\n                  :render-time=\"renderTime\"\r\n                  :ws-latency=\"wsLatency\"\r\n                ></performance-monitor>\r\n              </v-tab-item>\r\n            </v-tabs-items>\r\n          </v-card>\r\n          \r\n          <!-- 底部操作按钮 -->\r\n          <v-card class=\"mt-2 pa-2\">\r\n            <div class=\"d-flex justify-space-between\">\r\n              <v-btn small text color=\"primary\" @click=\"navigateToList\">\r\n                <v-icon small left>mdi-arrow-left</v-icon>返回列表\r\n              </v-btn>\r\n              <v-btn small text color=\"error\" @click=\"showDeleteDialog = true\">\r\n                <v-icon small left>mdi-delete</v-icon>删除模拟\r\n              </v-btn>\r\n            </div>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n    </v-container>\r\n    \r\n    <!-- 删除确认对话框 -->\r\n    <v-dialog v-model=\"showDeleteDialog\" max-width=\"400\">\r\n      <v-card>\r\n        <v-card-title class=\"headline\">确认删除?</v-card-title>\r\n        <v-card-text>此操作将永久删除该模拟及其所有相关数据，无法恢复。</v-card-text>\r\n        <v-card-actions>\r\n          <v-spacer></v-spacer>\r\n          <v-btn text @click=\"showDeleteDialog = false\">取消</v-btn>\r\n          <v-btn color=\"error\" text @click=\"deleteSimulation\" :loading=\"deleteLoading\">确认删除</v-btn>\r\n        </v-card-actions>\r\n      </v-card>\r\n    </v-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 导入组件\r\nimport SimulationCanvas from '../components/SimulationCanvas.vue';\r\nimport SimulationInfo from '../components/simulation/SimulationInfo.vue';\r\nimport HunterStatisticsChart from '../components/simulation/HunterStatisticsChart.vue';\r\nimport PerformanceMonitor from '../components/simulation/PerformanceMonitor.vue';\r\nimport EnvironmentSettingsPanel from '../components/simulation/EnvironmentSettingsPanel.vue';\r\nimport { setupWebSocket, closeWebSocket } from '../components/simulation/WebSocketManager.js';\r\nimport { mapState, mapGetters } from 'vuex';\r\n\r\nexport default {\r\n  name: 'SimulationDetail',\r\n  components: {\r\n    SimulationCanvas,\r\n    SimulationInfo,\r\n    HunterStatisticsChart,\r\n    PerformanceMonitor,\r\n    EnvironmentSettingsPanel\r\n  },\r\n  props: {\r\n    simulationId: {\r\n      type: Number,\r\n      required: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      simulation: {},\r\n      isRunning: false,\r\n      isCaptured: false,\r\n      socket: null,\r\n      showTrails: true,\r\n      showVisionRange: false,\r\n      showCommunicationRange: false,\r\n      showDeleteDialog: false,\r\n      deleteLoading: false,\r\n      \r\n      // 添加缺失的响应式属性\r\n      activeTab: 0,\r\n      \r\n      // WebSocket相关状态\r\n      wsLatency: 0,\r\n      lastMessageTime: 0,\r\n      \r\n      // 连接状态提示\r\n      showConnectionStatus: false,\r\n      connectionStatusText: '',\r\n      connectionStatusColor: 'info',\r\n      \r\n      // 性能监控\r\n      renderTime: 0,\r\n      lastRenderTimestamp: 0,\r\n      \r\n      // 数据处理相关\r\n      dataUpdateTimer: null,\r\n      \r\n      // 连接状态标记\r\n      isConnecting: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      storeCurrentSimulation: state => state.currentSimulation,\r\n      simulationsLoading: state => state.loading\r\n    }),\r\n    ...mapGetters([\r\n      'getSimulationById'\r\n    ]),\r\n    statusChipColor() {\r\n      if (this.isCaptured) return 'success';\r\n      if (this.isRunning) return 'primary';\r\n      return 'grey';\r\n    },\r\n    statusChipText() {\r\n      if (this.isCaptured) return '已捕获';\r\n      if (this.isRunning) return '进行中';\r\n      return '已停止';\r\n    }\r\n  },\r\n  created() {\r\n    // 注册错误处理事件监听\r\n    this.$root.$on('api-error', this.handleApiError);\r\n  },\r\n  mounted() {\r\n    console.log('SimulationDetail mounted');\r\n    // 监听页面可见性变化\r\n    document.addEventListener('visibilitychange', this.handleVisibilityChange);\r\n    window.addEventListener('focus', this.handleWindowFocus);\r\n    window.addEventListener('blur', this.handleWindowBlur);\r\n    \r\n    // 初始化组件\r\n    this.initializeComponent();\r\n  },\r\n  beforeDestroy() {\r\n    console.log('SimulationDetail beforeDestroy');\r\n    // 清理资源\r\n    this.closeWebSocketConnection();\r\n    this.cleanupTimers();\r\n    \r\n    // 移除事件监听\r\n    this.$root.$off('api-error', this.handleApiError);\r\n    document.removeEventListener('visibilitychange', this.handleVisibilityChange);\r\n    window.removeEventListener('focus', this.handleWindowFocus);\r\n    window.removeEventListener('blur', this.handleWindowBlur);\r\n  },\r\n  methods: {\r\n    // 初始化组件\r\n    async initializeComponent() {\r\n      console.log('初始化组件...');\r\n      try {\r\n        // 从API获取模拟数据\r\n        await this.fetchSimulation();\r\n        console.log('模拟数据获取成功:', this.simulation.id);\r\n\r\n        // 检查障碍物数量，如果为0但输入值不为0，则生成障碍物\r\n    if ((!this.simulation.obstacles || this.simulation.obstacles.length === 0) && \r\n        this.obstacleCount > 0) {\r\n      console.log('初始化障碍物...');\r\n      await this.regenerateObstacles(this.obstacleCount);\r\n    }\r\n        \r\n        // 设置捕获状态 - 确保正确加载已完成模拟的状态\r\n        this.isRunning = this.simulation.is_running;\r\n        this.isCaptured = this.simulation.is_captured;\r\n        \r\n        // 仅在模拟正在运行且未被捕获时建立WebSocket连接\r\n        if (this.isRunning && !this.isCaptured) {\r\n          this.setupWebSocketConnection();\r\n        } else if (this.isCaptured) {\r\n          // 如果模拟已经完成，显示捕获成功界面\r\n          console.log('模拟已捕获，显示完成状态');\r\n          \r\n          // 确保画布正确显示最终状态\r\n          this.$nextTick(() => {\r\n            if (this.$refs.canvas) {\r\n              this.$refs.canvas.drawSimulation(true);\r\n            }\r\n          });\r\n          \r\n          // 可选：加载捕获时的快照数据\r\n          this.loadFinalSnapshot();\r\n        }\r\n      } catch (error) {\r\n        console.error('初始化组件失败:', error);\r\n        this.showErrorStatus('初始化失败，请刷新页面重试');\r\n      }\r\n    },\r\n\r\n    // 添加加载最终快照的方法\r\n    async loadFinalSnapshot() {\r\n      try {\r\n        // 尝试加载捕获时的快照\r\n        const response = await this.axios.get(`/simulations/${this.simulationId}/final-snapshot`);\r\n        if (response.data) {\r\n          // 更新显示数据\r\n          if (response.data.hunters) {\r\n            this.simulation.hunters = response.data.hunters;\r\n          }\r\n          if (response.data.targets) {\r\n            this.simulation.targets = response.data.targets;\r\n          }\r\n          // 强制重绘画布\r\n          this.$nextTick(() => {\r\n            if (this.$refs.canvas) {\r\n              this.$refs.canvas.drawSimulation(true);\r\n            }\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.warn('加载最终快照失败:', e);\r\n        // 加载失败时不中断流程，使用默认显示\r\n      }\r\n    },\r\n    \r\n    // 获取模拟数据\r\n    async fetchSimulation() {\r\n      try {\r\n        console.log('获取模拟数据, ID:', this.simulationId);\r\n        // 尝试从store获取数据\r\n        let storeSimulation = this.getSimulationById(this.simulationId);\r\n        \r\n        // 如果store中没有数据，从API获取\r\n        if (!storeSimulation) {\r\n          console.log('从API获取模拟数据');\r\n          const response = await this.$store.dispatch('fetchSimulation', this.simulationId);\r\n          this.simulation = response;\r\n        } else {\r\n          console.log('从Store获取模拟数据');\r\n          this.simulation = storeSimulation;\r\n        }\r\n        \r\n        // 更新状态\r\n        this.isRunning = this.simulation.is_running;\r\n        this.isCaptured = this.simulation.is_captured;\r\n        \r\n        console.log('模拟数据获取完成:', this.simulation.name);\r\n        return this.simulation;\r\n      } catch (error) {\r\n        console.error('获取模拟数据失败:', error);\r\n        this.$toast.error('获取模拟数据失败');\r\n        throw error;\r\n      }\r\n    },\r\n    \r\n    // 设置WebSocket连接\r\n    setupWebSocketConnection() {\r\n      // 连接创建中标记，防止重复创建\r\n      if (this.isConnecting) {\r\n        console.log('WebSocket连接已在创建中，避免重复创建');\r\n        return;\r\n      }\r\n      \r\n      this.isConnecting = true;\r\n      \r\n      // 确保先关闭已有连接\r\n      if (this.socket) {\r\n        console.log('关闭已有WebSocket连接，准备创建新连接');\r\n        this.closeWebSocketConnection();\r\n        \r\n        // 添加短延迟确保连接完全关闭\r\n        setTimeout(() => {\r\n          this.createNewWebSocketConnection();\r\n        }, 300);\r\n      } else {\r\n        this.createNewWebSocketConnection();\r\n      }\r\n    },\r\n    \r\n    // 提取创建连接的逻辑为单独方法\r\n    createNewWebSocketConnection() {\r\n      console.log(`创建WebSocket连接，模拟ID: ${this.simulationId}`);\r\n      \r\n      this.socket = setupWebSocket(this.simulationId, {\r\n        onOpen: () => {\r\n          console.log(`WebSocket连接已建立，模拟ID: ${this.simulationId}`);\r\n          this.showSuccessStatus('WebSocket连接已建立');\r\n          this.isConnecting = false; // 重置连接状态\r\n        },\r\n        onMessage: (data) => {\r\n          this.handleWebSocketMessage(data);\r\n        },\r\n        onClose: (event) => {\r\n          // 如果是正常关闭，不显示错误\r\n          if (event.code !== 1000 && event.code !== 1001) {\r\n            this.showWarningStatus('WebSocket连接已关闭');\r\n          }\r\n          this.isConnecting = false; // 重置连接状态\r\n        },\r\n        onError: () => {\r\n          this.showErrorStatus('WebSocket连接错误');\r\n          this.isConnecting = false; // 重置连接状态\r\n        }\r\n      });\r\n    },\r\n    \r\n    // 改进closeWebSocketConnection方法\r\n    closeWebSocketConnection() {\r\n      if (this.socket) {\r\n        console.log(`关闭WebSocket连接，模拟ID: ${this.simulationId}`);\r\n        closeWebSocket(this.socket);\r\n        this.socket = null;\r\n      }\r\n    },\r\n    \r\n    // 处理WebSocket消息\r\n    handleWebSocketMessage(data) {\r\n      // 计算延迟\r\n      this.calculateWsLatency();\r\n      \r\n      // 处理错误\r\n      if (data.error) {\r\n        console.error('WebSocket错误:', data.error);\r\n        this.$toast.error(`WebSocket错误: ${data.error}`);\r\n        return;\r\n      }\r\n      \r\n      // 使用防抖更新数据，避免频繁更新\r\n      this.updateSimulationDataDebounced(data);\r\n    },\r\n    \r\n    // 计算WebSocket延迟\r\n    calculateWsLatency() {\r\n      const now = performance.now();\r\n      if (this.lastMessageTime) {\r\n        this.wsLatency = Math.round(now - this.lastMessageTime);\r\n      }\r\n      this.lastMessageTime = now;\r\n    },\r\n    \r\n    // 防抖更新数据\r\n    updateSimulationDataDebounced(data) {\r\n      if (this.dataUpdateTimer) {\r\n        clearTimeout(this.dataUpdateTimer);\r\n      }\r\n      \r\n      this.dataUpdateTimer = setTimeout(() => {\r\n        const startTime = performance.now();\r\n        \r\n        // 更新模拟数据\r\n        this.simulation = data;\r\n        this.isRunning = data.is_running;\r\n        this.isCaptured = data.is_captured;\r\n        \r\n        // 更新Vuex存储\r\n        this.$store.dispatch('updateSimulationAgents', {\r\n          simulationId: this.simulationId,\r\n          hunters: data.hunters || [],\r\n          targets: data.targets || []\r\n        });\r\n        \r\n        // 计算渲染时间\r\n        this.renderTime = Math.round(performance.now() - startTime);\r\n      }, 50); // 50ms防抖延迟\r\n    },\r\n    \r\n    // 模拟控制方法\r\n    async startSimulation() {\r\n      try {\r\n        // 先关闭可能存在的旧连接\r\n        console.log('启动模拟，关闭已有WebSocket连接');\r\n        this.closeWebSocketConnection();\r\n        \r\n        // 添加短延迟确保连接完全关闭\r\n        await new Promise(resolve => setTimeout(resolve, 200));\r\n        \r\n        // 发送启动请求到API\r\n        await this.$store.dispatch('startSimulation', this.simulationId);\r\n        this.isRunning = true;\r\n        \r\n        // 重新建立WebSocket连接以接收实时更新\r\n        console.log('模拟已启动，创建新WebSocket连接');\r\n        this.setupWebSocketConnection();\r\n        \r\n        this.$toast.success('模拟已启动');\r\n      } catch (error) {\r\n        console.error('启动模拟失败:', error);\r\n        this.$toast.error('启动模拟失败');\r\n        this.isConnecting = false; // 确保重置连接状态\r\n      }\r\n    },\r\n    \r\n    async stopSimulation() {\r\n      try {\r\n        await this.$store.dispatch('stopSimulation', this.simulationId);\r\n        this.isRunning = false;\r\n        this.$toast.success('模拟已停止');\r\n      } catch (error) {\r\n        console.error('停止模拟失败:', error);\r\n        this.$toast.error('停止模拟失败');\r\n      }\r\n    },\r\n    \r\n    async resetSimulation() {\r\n      try {\r\n        const data = await this.$store.dispatch('resetSimulation', this.simulationId);\r\n        this.simulation = data;\r\n        this.isRunning = false;\r\n        this.isCaptured = false;\r\n        \r\n        this.$toast.success('模拟已重置');\r\n      } catch (error) {\r\n        console.error('重置模拟失败:', error);\r\n        this.$toast.error('重置模拟失败');\r\n      }\r\n    },\r\n    \r\n    async deleteSimulation() {\r\n      this.deleteLoading = true;\r\n      try {\r\n        await this.$store.dispatch('deleteSimulation', this.simulationId);\r\n        this.$toast.success('模拟已删除');\r\n        this.$router.push('/simulations');\r\n      } catch (error) {\r\n        console.error('删除模拟失败:', error);\r\n        this.$toast.error('删除模拟失败');\r\n      } finally {\r\n        this.deleteLoading = false;\r\n        this.showDeleteDialog = false;\r\n      }\r\n    },\r\n    \r\n    // 优化页面可见性变化处理\r\n    handleVisibilityChange() {\r\n      if (document.hidden) {\r\n        // 页面隐藏时关闭WebSocket\r\n        console.log('页面隐藏，关闭WebSocket连接');\r\n        this.closeWebSocketConnection();\r\n      } else {\r\n        // 页面可见时，只在需要时重新连接\r\n        if (this.isRunning && !this.isCaptured && !this.socket && !this.isConnecting) {\r\n          console.log('页面可见，模拟运行中，重新连接WebSocket');\r\n          this.setupWebSocketConnection();\r\n        }\r\n      }\r\n    },\r\n    \r\n    // 优化窗口焦点变化处理\r\n    handleWindowFocus() {\r\n      if (this.isRunning && !this.isCaptured && !this.socket && !this.isConnecting) {\r\n        console.log('窗口获得焦点，模拟运行中，重新连接WebSocket');\r\n        this.setupWebSocketConnection();\r\n      }\r\n    },\r\n    \r\n    handleWindowBlur() {\r\n      // 窗口失去焦点时无需处理\r\n    },\r\n    \r\n    // 导航方法\r\n    navigateToList() {\r\n      // 清理资源后再导航\r\n      this.closeWebSocketConnection();\r\n      this.cleanupTimers();\r\n      this.$router.push('/simulations');\r\n    },\r\n    \r\n    // 状态提示显示方法\r\n    showInfoStatus(message) {\r\n      this.connectionStatusText = message;\r\n      this.connectionStatusColor = 'info';\r\n      this.showConnectionStatus = true;\r\n    },\r\n    \r\n    showSuccessStatus(message) {\r\n      this.connectionStatusText = message;\r\n      this.connectionStatusColor = 'success';\r\n      this.showConnectionStatus = true;\r\n    },\r\n    \r\n    showWarningStatus(message) {\r\n      this.connectionStatusText = message;\r\n      this.connectionStatusColor = 'warning';\r\n      this.showConnectionStatus = true;\r\n    },\r\n    \r\n    showErrorStatus(message) {\r\n      this.connectionStatusText = message;\r\n      this.connectionStatusColor = 'error';\r\n      this.showConnectionStatus = true;\r\n    },\r\n    \r\n    // 错误处理\r\n    handleApiError(error) {\r\n      console.error('API错误:', error);\r\n      \r\n      // 特定错误处理\r\n      if (error.status === 404 && error.message.includes('Simulation not found')) {\r\n        this.$toast.error('模拟不存在或已被删除');\r\n        this.$router.push('/simulations');\r\n      }\r\n    },\r\n    \r\n    // 清理定时器\r\n    cleanupTimers() {\r\n      if (this.dataUpdateTimer) {\r\n        clearTimeout(this.dataUpdateTimer);\r\n        this.dataUpdateTimer = null;\r\n      }\r\n    },\r\n\r\n    // 新增: 环境设置方法\r\n    toggleObstacles(show) {\r\n      // 控制障碍物显示/隐藏\r\n      if (this.$refs.canvas) {\r\n        this.$refs.canvas.showObstacles = show;\r\n        this.drawSimulation(); // 重新绘制\r\n      }\r\n    },\r\n    \r\n    regenerateObstacles(count) {\r\n      // 显示加载状态\r\n      this.$toast.info(`正在生成${count}个障碍物...`);\r\n      \r\n      // 调用API重新生成障碍物\r\n      this.axios.post(`/simulations/${this.simulationId}/regenerate-obstacles`, { count })\r\n        .then(response => {\r\n          if (response.data && response.data.obstacles) {\r\n            // 更新模拟中的障碍物\r\n            this.simulation.obstacles = response.data.obstacles;\r\n            this.$toast.success('障碍物已重新生成');\r\n            \r\n            // 强制重绘画布\r\n            if (this.$refs.canvas) {\r\n              this.$refs.canvas.drawSimulation(true);\r\n            }\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error('重新生成障碍物失败:', error);\r\n          this.$toast.error('重新生成障碍物失败');\r\n        });\r\n    },\r\n  watch: {\r\n    simulationId: {\r\n      handler(newId, oldId) {\r\n        if (newId !== oldId) {\r\n          console.log(`模拟ID变更: ${oldId} -> ${newId}`);\r\n          // 重新初始化组件\r\n          this.closeWebSocketConnection();\r\n          this.cleanupTimers();\r\n          this.initializeComponent();\r\n        }\r\n      },\r\n      immediate: false\r\n    },\r\n    \r\n    // 监视store中的当前模拟数据变化\r\n    storeCurrentSimulation: {\r\n      handler(newSimulation) {\r\n        if (newSimulation && newSimulation.id === this.simulationId) {\r\n          // 仅在首次加载或重要属性变化时更新本地数据\r\n          if (!this.simulation.id || \r\n              newSimulation.is_running !== this.simulation.is_running ||\r\n              newSimulation.is_captured !== this.simulation.is_captured) {\r\n            this.simulation = newSimulation;\r\n            this.isRunning = newSimulation.is_running;\r\n            this.isCaptured = newSimulation.is_captured;\r\n          }\r\n        }\r\n      },\r\n      deep: true\r\n    }\r\n  }\r\n}\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.simulation-detail {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n}\r\n\r\n/* 控制内容区域的最大宽度和居中 */\r\n.content-container {\r\n  max-width: 1200px !important;\r\n  margin: 0 auto !important;\r\n  padding: 12px !important; /* 修改为四周都有padding */\r\n}\r\n\r\n.content-row {\r\n  justify-content: center;\r\n}\r\n\r\n.simulation-canvas-card {\r\n  height: calc(100vh - 100px);\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-top: 16px; /* 添加顶部边距 */\r\n}\r\n\r\n.control-panel {\r\n  height: auto;\r\n}\r\n\r\n/* 控制元素样式优化 */\r\n:deep(.v-input--switch) {\r\n  margin-top: 0;\r\n}\r\n\r\n:deep(.v-messages) {\r\n  min-height: 0;\r\n}\r\n\r\n:deep(.v-card__title) {\r\n  padding: 8px 12px;\r\n}\r\n\r\n:deep(.v-card__text) {\r\n  padding: 8px 12px;\r\n}\r\n\r\n.title-section {\r\n  padding: 8px 4px;\r\n}\r\n\r\n/* 响应式设计优化 */\r\n@media (max-width: 960px) {\r\n  .simulation-canvas-card {\r\n    height: 60vh;\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}